<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Quáº£n LÃ½ NhÃ¢n Sá»± - LSPD</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <head><body>
    <script>
document.addEventListener("DOMContentLoaded", () => {
  const me = JSON.parse(localStorage.getItem("lspd_me") || "{}");

  // Náº¿u khÃ´ng pháº£i Admin -> quay vá» dashboard
  if (me.role !== "Admin") {
    alert("Báº¡n khÃ´ng cÃ³ quyá»n truy cáº­p trang nÃ y!");
    location.href = "dashboard.html";
  }
});
</script>

  </body></head>
  <style>
    body {
      background:url('background.jpg') no-repeat center center fixed;
      background-size:cover;
    }
    .content-box {
      background:rgba(255,255,255,0.9);
      padding:20px;
      border-radius:10px;
      box-shadow:0 0 15px rgba(0,0,0,0.3);
    }
  </style>
</head>
<body>
<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container-fluid">
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav me-auto">
        <li class="nav-item"><a class="nav-link" href="dashboard.html">Trang Chá»§</a></li>
        <li class="nav-item"><a class="nav-link" href="duty.html">Cháº¥m CÃ´ng</a></li>
        <li class="nav-item"><a class="nav-link" href="bail.html">Báº£o LÃ£nh</a></li>
        <li class="nav-item"><a class="nav-link" href="support.html">Xá»­ Ãn</a></li>
        <li class="nav-item"><a class="nav-link" href="wanted.html">Truy NÃ£</a></li>
        <li class="nav-item"><a class="nav-link" href="wanted.html">Báº£o LÃ£nh</a></li>
        <li class="nav-item"><a class="nav-link" href="leave.html">Nghá»‰ PhÃ©p</a></li>
        <li class="nav-item"><a class="nav-link" href="salary.html">ğŸ’° Há»‡ Sá»‘ LÆ°Æ¡ng</a></li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle active" href="#" role="button" data-bs-toggle="dropdown">Quáº£n LÃ½</a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="manage.html">ğŸ‘® NhÃ¢n Sá»±</a></li>
            <li><a class="dropdown-item" href="salary.html">ğŸ’° Há»‡ Sá»‘ LÆ°Æ¡ng</a></li>
            <li><a class="dropdown-item" href="timekeeping.html">ğŸ•’ CÃ´ng/LÆ°Æ¡ng</a></li>
            <li><a class="dropdown-item active" href="tasks.html">âš™ï¸ TÃ¡c Vá»¥ Chung</a></li>
          </ul>
        </li>
      </ul>
      <a href="#" id="btnLogout" class="btn btn-outline-warning btn-sm">ÄÄƒng xuáº¥t</a>
    </div>
  </div>
</nav>

<div class="container my-4">
  <div class="content-box">
    <h2 class="mb-3">ğŸ“‹ Quáº£n LÃ½ NhÃ¢n Sá»±</h2>

    <!-- Form thÃªm -->
    <form id="addUserForm" class="row g-3 mb-4">
      <div class="col-md-4"><input type="text" id="username" class="form-control" placeholder="TÃªn Ä‘Äƒng nháº­p" required></div>
      <div class="col-md-4"><input type="password" id="password" class="form-control" placeholder="Máº­t kháº©u" required></div>
      <div class="col-md-4"><input type="text" id="name" class="form-control" placeholder="Há» vÃ  tÃªn sÄ© quan" required></div>

      <div class="col-md-3">
        <select id="role" class="form-select">
          <option value="User">NhÃ¢n ViÃªn</option>
          <option value="Admin">Quáº£n Trá»‹ ViÃªn</option>
        </select>
      </div>
      <div class="col-md-3">
        <select id="position" class="form-select">
          <option value="GiÃ¡m Äá»‘c">GiÃ¡m Äá»‘c</option>
          <option value="PhÃ³ GiÃ¡m Äá»‘c">PhÃ³ GiÃ¡m Äá»‘c</option>
          <option value="Trá»£ LÃ½ GiÃ¡m Äá»‘c">Trá»£ LÃ½ GiÃ¡m Äá»‘c</option>
          <option value="ThÆ° kÃ½">ThÆ° kÃ½</option>
          <option value="Äá»™i trÆ°á»Ÿng">Äá»™i trÆ°á»Ÿng</option>
          <option value="PhÃ³ Ä‘á»™i trÆ°á»Ÿng">PhÃ³ Ä‘á»™i trÆ°á»Ÿng</option>
          <option value="Cáº£nh sÃ¡t viÃªn">Cáº£nh sÃ¡t viÃªn</option>
          <option value="Thá»±c Táº­p">Thá»±c Táº­p</option>
        </select>
      </div>
      <div class="col-md-3">
        <select id="rank" class="form-select">
          <option value="Äáº¡i tÃ¡">Äáº¡i tÃ¡</option>
          <option value="ThÆ°á»£ng tÃ¡">ThÆ°á»£ng tÃ¡</option>
          <option value="Trung tÃ¡">Trung tÃ¡</option>
          <option value="Thiáº¿u tÃ¡">Thiáº¿u tÃ¡</option>
          <option value="Äáº¡i Ãºy">Äáº¡i Ãºy</option>
          <option value="ThÆ°á»£ng Ãºy">ThÆ°á»£ng Ãºy</option>
          <option value="Trung Ãºy">Trung Ãºy</option>
          <option value="Thiáº¿u Ãºy">Thiáº¿u Ãºy</option>
          <option value="ThÆ°á»£ng sÄ©">ThÆ°á»£ng sÄ©</option>
          <option value="Trung sÄ©">Trung sÄ©</option>
          <option value="Háº¡ sÄ©">Háº¡ sÄ©</option>
        </select>
      </div>
      <div class="col-md-3"><input type="number" id="rate" class="form-control" placeholder="LÆ°Æ¡ng/giá»" value="50"></div>

      <div class="col-12 text-end"><button type="submit" class="btn btn-primary">â• ThÃªm nhÃ¢n sá»±</button></div>
    </form>

    <!-- Search + Export + History + Trash -->
    <div class="d-flex justify-content-between align-items-center mb-3">
      <input type="text" id="searchUser" placeholder="ğŸ” TÃ¬m sÄ© quan hoáº·c tÃ i khoáº£n..." class="form-control w-50">
      <div>
        <button onclick="exportExcel()" class="btn btn-success">ğŸ“¥ Xuáº¥t Excel</button>
        <button class="btn btn-info" onclick="showHistory()">ğŸ•˜ Lá»‹ch Sá»­</button>
        <button class="btn btn-warning" onclick="showTrash()">ğŸ—‘ ThÃ¹ng RÃ¡c</button>
      </div>
    </div>

    <!-- Báº£ng -->
    <div class="table-responsive">
      <table id="usersTbl" class="table table-striped table-bordered align-middle">
        <thead class="table-dark">
              <tr>
                <th>STT</th><th>TÃ i khoáº£n</th><th>TÃªn sÄ© quan</th>
                <th>Vai trÃ²</th><th>Chá»©c vá»¥</th><th>QuÃ¢n hÃ m</th><th>LÆ°Æ¡ng/giá»</th><th>HÃ nh Ä‘á»™ng</th>
              </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>

<!-- Modal lá»‹ch sá»­ -->
<div class="modal fade" id="historyModal" tabindex="-1">
  <div class="modal-dialog modal-lg"><div class="modal-content">
    <div class="modal-header"><h5 class="modal-title">ğŸ•˜ Lá»‹ch Sá»­ Hoáº¡t Äá»™ng</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
    <div class="modal-body"><ul id="historyList" class="list-group"></ul></div>
  </div></div>
</div>

<!-- Modal thÃ¹ng rÃ¡c -->
<div class="modal fade" id="trashModal" tabindex="-1">
  <div class="modal-dialog modal-lg"><div class="modal-content">
    <div class="modal-header"><h5 class="modal-title">ğŸ—‘ NhÃ¢n Sá»± Trong ThÃ¹ng RÃ¡c</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
    <div class="modal-body">
      <table class="table table-striped"><thead><tr><th>TÃ i khoáº£n</th><th>TÃªn</th><th>Chá»©c vá»¥</th><th>Thao tÃ¡c</th></tr></thead><tbody id="trashList"></tbody></table>
    </div>
  </div></div>
</div>

<script>
const posOrder = {"GiÃ¡m Äá»‘c":1,"PhÃ³ GiÃ¡m Äá»‘c":2,"Trá»£ LÃ½ GiÃ¡m Äá»‘c":3,"ThÆ° kÃ½":4,"Äá»™i trÆ°á»Ÿng":5,"PhÃ³ Ä‘á»™i trÆ°á»Ÿng":6,"Cáº£nh sÃ¡t viÃªn":7,"Thá»±c Táº­p":8};
const rankOrder={"Äáº¡i tÃ¡":1,"ThÆ°á»£ng tÃ¡":2,"Trung tÃ¡":3,"Thiáº¿u tÃ¡":4,"Äáº¡i Ãºy":5,"ThÆ°á»£ng Ãºy":6,"Trung Ãºy":7,"Thiáº¿u Ãºy":8,"ThÆ°á»£ng sÄ©":9,"Trung sÄ©":10,"Háº¡ sÄ©":11};

function getUsers(){return JSON.parse(localStorage.getItem("lspd_users")||"[]");}
function setUsers(arr){localStorage.setItem("lspd_users",JSON.stringify(arr));}
function getTrash(){return JSON.parse(localStorage.getItem("lspd_trash")||"[]");}
function setTrash(arr){localStorage.setItem("lspd_trash",JSON.stringify(arr));}
function getHistory(){return JSON.parse(localStorage.getItem("lspd_history")||"[]");}
function pushHistory(msg){let h=getHistory();h.push(msg+" - "+new Date().toLocaleString());localStorage.setItem("lspd_history",JSON.stringify(h));}

function renderUsers(){
  let users=getUsers();
  let s=document.getElementById("searchUser").value.toLowerCase();
  let f=users.filter(u=>u.username.toLowerCase().includes(s)||u.name.toLowerCase().includes(s));
  f.sort((a,b)=> (posOrder[a.position]||99)-(posOrder[b.position]||99) || (rankOrder[a.rank]||99)-(rankOrder[b.rank]||99));
  document.querySelector("#usersTbl tbody").innerHTML=f.map((u,i)=>`
    <tr><td>${i+1}</td><td>${u.username}</td><td>${u.name}</td>
    <td>${u.role}</td><td>${u.position}</td><td>${u.rank}</td><td>${u.rate}</td>
    <td><button class="btn btn-sm btn-danger" onclick="deleteUser(${u.id})">âŒ XÃ³a</button></td></tr>`).join("");
}

// âœ… FIXED thÃªm nhÃ¢n sá»±
document.getElementById("addUserForm").addEventListener("submit",e=>{
  e.preventDefault();
  let users=getUsers();
  const u={
    id:Date.now(),
    username:document.getElementById("username").value.trim(),
    password:document.getElementById("password").value,
    name:document.getElementById("name").value.trim(),
    role:document.getElementById("role").value,
    position:document.getElementById("position").value,
    rank:document.getElementById("rank").value,
    rate:Number(document.getElementById("rate").value)
  };
  users.push(u); setUsers(users);
  pushHistory("â• ThÃªm "+u.name+" ("+u.username+")");
  e.target.reset(); document.getElementById("rate").value=50;
  renderUsers();
});

function deleteUser(id){let u=getUsers();let t=getTrash();let x=u.find(a=>a.id==id);if(!x)return;t.push(x);setTrash(t);pushHistory("âŒ XÃ³a "+x.name);setUsers(u.filter(a=>a.id!=id));renderUsers();}
function restoreUser(id){let u=getUsers();let t=getTrash();let x=t.find(a=>a.id==id);if(!x)return;u.push(x);setUsers(u);setTrash(t.filter(a=>a.id!=id));pushHistory("â™»ï¸ KhÃ´i phá»¥c "+x.name);renderUsers();}
function showHistory(){document.getElementById("historyList").innerHTML=getHistory().map(h=>`<li class="list-group-item">${h}</li>`).join("");new bootstrap.Modal(document.getElementById("historyModal")).show();}
function showTrash(){document.getElementById("trashList").innerHTML=getTrash().map(u=>`<tr><td>${u.username}</td><td>${u.name}</td><td>${u.position}</td><td><button class="btn btn-sm btn-success" onclick="restoreUser(${u.id})">KhÃ´i phá»¥c</button></td></tr>`).join("");new bootstrap.Modal(document.getElementById("trashModal")).show();}
function exportExcel(){let u=getUsers();if(!u.length)return alert("ChÆ°a cÃ³ dá»¯ liá»‡u");let d=u.map((x,i)=>({STT:i+1,"TÃ i khoáº£n":x.username,"TÃªn":x.name,"Vai trÃ²":x.role,"Chá»©c vá»¥":x.position,"QuÃ¢n hÃ m":x.rank,"LÆ°Æ¡ng/giá»":x.rate}));let ws=XLSX.utils.json_to_sheet(d),wb=XLSX.utils.book_new();XLSX.utils.book_append_sheet(wb,ws,"NhanSu");XLSX.writeFile(wb,"NhanSu.xlsx");}
document.getElementById("searchUser").addEventListener("input",renderUsers);
renderUsers();
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
<!-- ... giá»¯ nguyÃªn pháº§n HTML trÆ°á»›c Ä‘Ã³ ... -->

<div class="table-responsive">
  <table id="usersTbl" class="table table-striped table-bordered align-middle">
    <thead class="table-dark">
      <tr>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- Modal sá»­a -->
<div class="modal fade" id="editModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">âœï¸ Sá»­a NhÃ¢n Sá»±</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="editUserForm" class="row g-3">
          <input type="hidden" id="editId">
          <div class="col-md-6">
            <label class="form-label">TÃªn Ä‘Äƒng nháº­p</label>
            <input type="text" id="editUsername" class="form-control" required>
          </div>
          <div class="col-md-6">
            <label class="form-label">Há» vÃ  tÃªn sÄ© quan</label>
            <input type="text" id="editName" class="form-control" required>
          </div>
          <div class="col-md-6">
            <label class="form-label">Vai trÃ²</label>
            <select id="editRole" class="form-select">
              <option value="User">User</option>
              <option value="Admin">Admin</option>
            </select>
          </div>
          <div class="col-md-6">
            <label class="form-label">Chá»©c vá»¥</label>
            <select id="editPosition" class="form-select">
              <option value="GiÃ¡m Äá»‘c">GiÃ¡m Äá»‘c</option>
              <option value="PhÃ³ GiÃ¡m Äá»‘c">PhÃ³ GiÃ¡m Äá»‘c</option>
              <option value="Trá»£ LÃ½ GiÃ¡m Äá»‘c">Trá»£ LÃ½ GiÃ¡m Äá»‘c</option>
              <option value="ThÆ° kÃ½">ThÆ° kÃ½</option>
              <option value="Äá»™i trÆ°á»Ÿng">Äá»™i trÆ°á»Ÿng</option>
              <option value="PhÃ³ Ä‘á»™i trÆ°á»Ÿng">PhÃ³ Ä‘á»™i trÆ°á»Ÿng</option>
              <option value="Cáº£nh sÃ¡t viÃªn">Cáº£nh sÃ¡t viÃªn</option>
              <option value="Thá»±c Táº­p">Thá»±c Táº­p</option>
            </select>
          </div>
          <div class="col-md-6">
            <label class="form-label">QuÃ¢n hÃ m</label>
            <select id="editRank" class="form-select">
              <option value="Äáº¡i tÃ¡">Äáº¡i tÃ¡</option>
              <option value="ThÆ°á»£ng tÃ¡">ThÆ°á»£ng tÃ¡</option>
              <option value="Trung tÃ¡">Trung tÃ¡</option>
              <option value="Thiáº¿u tÃ¡">Thiáº¿u tÃ¡</option>
              <option value="Äáº¡i Ãºy">Äáº¡i Ãºy</option>
              <option value="ThÆ°á»£ng Ãºy">ThÆ°á»£ng Ãºy</option>
              <option value="Trung Ãºy">Trung Ãºy</option>
              <option value="Thiáº¿u Ãºy">Thiáº¿u Ãºy</option>
              <option value="ThÆ°á»£ng sÄ©">ThÆ°á»£ng sÄ©</option>
              <option value="Trung sÄ©">Trung sÄ©</option>
              <option value="Háº¡ sÄ©">Háº¡ sÄ©</option>
            </select>
          </div>
          <div class="col-md-6">
            <label class="form-label">LÆ°Æ¡ng/giá»</label>
            <input type="number" id="editRate" class="form-control" required>
          </div>
          <div class="col-12 text-end">
            <button type="submit" class="btn btn-success">ğŸ’¾ Cáº­p nháº­t</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
function renderUsers(){
  let users=getUsers();
  let s=document.getElementById("searchUser").value.toLowerCase();
  let f=users.filter(u=>u.username.toLowerCase().includes(s)||u.name.toLowerCase().includes(s));
  f.sort((a,b)=> (posOrder[a.position]||99)-(posOrder[b.position]||99) || (rankOrder[a.rank]||99)-(rankOrder[b.rank]||99));
  document.querySelector("#usersTbl tbody").innerHTML=f.map((u,i)=>`
    <tr>
      <td>${i+1}</td><td>${u.username}</td><td>${u.name}</td>
      <td>${u.role}</td><td>${u.position}</td><td>${u.rank}</td><td>${u.rate}</td>
      <td>
        <button class="btn btn-sm btn-warning" onclick="openEdit(${u.id})">âœï¸ Sá»­a</button>
        <button class="btn btn-sm btn-danger" onclick="deleteUser(${u.id})">âŒ XÃ³a</button>
      </td>
    </tr>`).join("");
}

// Má»Ÿ modal sá»­a
function openEdit(id){
  let u=getUsers().find(x=>x.id==id);
  if(!u) return;
  document.getElementById("editId").value=u.id;
  document.getElementById("editUsername").value=u.username;
  document.getElementById("editName").value=u.name;
  document.getElementById("editRole").value=u.role;
  document.getElementById("editPosition").value=u.position;
  document.getElementById("editRank").value=u.rank;
  document.getElementById("editRate").value=u.rate;
  new bootstrap.Modal(document.getElementById("editModal")).show();
}

// Cáº­p nháº­t nhÃ¢n sá»±
document.getElementById("editUserForm").addEventListener("submit",e=>{
  e.preventDefault();
  let users=getUsers();
  let id=parseInt(document.getElementById("editId").value);
  let idx=users.findIndex(x=>x.id==id);
  if(idx>-1){
    users[idx].username=document.getElementById("editUsername").value.trim();
    users[idx].name=document.getElementById("editName").value.trim();
    users[idx].role=document.getElementById("editRole").value;
    users[idx].position=document.getElementById("editPosition").value;
    users[idx].rank=document.getElementById("editRank").value;
    users[idx].rate=Number(document.getElementById("editRate").value);
    setUsers(users);
    pushHistory("âœï¸ Sá»­a "+users[idx].name+" ("+users[idx].username+")");
    renderUsers();
    bootstrap.Modal.getInstance(document.getElementById("editModal")).hide();
  }
});
</script></body><script>
// ================== QUYá»€N THEO VAI TRÃ’ ==================
document.addEventListener("DOMContentLoaded", () => {
  const me = JSON.parse(localStorage.getItem("lspd_me") || "{}");

  // áº¨n menu Quáº£n LÃ½ náº¿u khÃ´ng pháº£i Admin
  if (me.role !== "Admin") {
    document.querySelectorAll("a, .dropdown-menu a").forEach(link => {
      if (link.textContent.includes("Quáº£n LÃ½")) {
        link.style.display = "none";
      }
    });
  }

  // Náº¿u khÃ´ng pháº£i Admin -> áº©n quyá»n quáº£n lÃ½ trong trang
  if (me.role !== "Admin") {
    // áº¨n form thÃªm
    const addForm = document.getElementById("addUserForm");
    if (addForm) addForm.style.display = "none";

    // áº¨n nÃºt Export, Lá»‹ch sá»­, ThÃ¹ng rÃ¡c
    document.querySelectorAll("button").forEach(btn => {
      if (
        btn.textContent.includes("Xuáº¥t Excel") ||
        btn.textContent.includes("Lá»‹ch Sá»­") ||
        btn.textContent.includes("ThÃ¹ng RÃ¡c")
      ) {
        btn.style.display = "none";
      }
    });

    // Override renderUsers Ä‘á»ƒ xÃ³a quyá»n Sá»­a/XÃ³a
    const oldRender = renderUsers;
    renderUsers = function() {
      oldRender();
      document.querySelectorAll("#usersTbl tbody tr").forEach(tr => {
        const tdAction = tr.querySelector("td:last-child");
        if (tdAction) tdAction.innerHTML = `<span class="text-muted">âŒ KhÃ´ng cÃ³ quyá»n</span>`;
      });
    };
    renderUsers();
  }
});
</script>
</body>
</html>